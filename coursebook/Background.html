<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">

  <!-- If for some reason you are using IE, use edge -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!-- So bootstrap isn't horrible, set the width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="mask-icon" href="/images/favicons/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="theme-color" content="#ffffff">

  <title>Background</title>

  <!-- Reference a CDN so this is properly cached in the browser forever. Unless they clean out the
       Cache this will incur no load time. Ideally we should put a security checksum but that breaks
       Firefox development sometimes -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" crossorigin="anonymous">

  <!-- Asynchronously load the code style sheet because we want everything loaded as fast as possible
       Also tag with ?v=time to bust the cache of any browser so updates appear -->
  <link async rel="stylesheet" href="/css/code-style.css?v='2019-01-16 13:38:19 -0600'">

  <!-- Don't load async because this will make the page render faster, plus the file is small.
       Also do the same cache busting magic here -->
  <link rel="stylesheet" href="/css/main.css?v='2019-01-16 13:38:19 -0600'">

</head>

<body>
<!-- Always shows a header, even in smaller screens. -->
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">

            <!-- Navigation button as html so we don't have to resize images -->
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>


            <!-- Inline tux for speed -->
            <a id="tuxlink"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAJCAMAAAA4jZ0cAAAAM1BMVEX///8CAgQMDAwsLCw0NDSjbQCkbQC+vbzOkwDU1NTlrADqvADxtgD0vQD12wD+/vz+//yBSdYEAAAAAXRSTlMAQObYZgAAADFJREFUCB0FwQkCQDAQBLCsq6g1/v9aCVQBthUwX8BIgStZCpUvKXSSLs6eyd0Pdg5+JwkBVyC74QYAAAAASUVORK5CYII=" title="Tux" alt="Tux" style="margin-left: 1em; width: 24px; filter: drop-shadow(1px 1px 0 white) drop-shadow(1px -1px 0 white) drop-shadow(-1px 1px 0 white) drop-shadow(-1px -1px 0 white); margin-top: 1em;"/></a>

            <a class="navbar-brand navbar-link normal" href="/">CS 241: System Programming</a>
            <a class="navbar-brand navbar-link small" href="/">CS 241</a>
        </div>

        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            
            <li>
                <a class="navbar-link" href="/assignments.html">Assignments</a>
            </li>
            
            <li>
                <a class="navbar-link" href="/quiz_topics.html">Quizzes</a>
            </li>
            
            <li>
                <a class="navbar-link" href="/help.html">Help!</a>
            </li>
            
            <li>
                <a class="navbar-link" href="/schedule.html">Schedule</a>
            </li>
            
            <li>
                <a class="navbar-link" href="/honors.html">Honors</a>
            </li>
            
            <li>
                <a class="navbar-link" href="/staff.html">The Crew</a>
            </li>
            
            <li>
                <a class="navbar-link" href="/search.html">Search</a>
            </li>
            
            <li>
                <a class="navbar-link" href="/coursebook/index.html">Coursebook</a>
            </li>
            
          </ul>
        </div>
        </div>
</nav>


<div class="container-fluid">
  <div class="row">
    <div class="col-md-2 col-sm-1 col-xs-0"></div>
    <div class="col-md-8 col-sm-10 col-xs-12">
      <div class="wrapper">
        <div class="pad"><div class="card">
          <div class="title">
            <div class="speaker-wrapper">
              <button onclick="speak()" class="speaker" alt="Read Page"></button>
            </div>
            
            
            
            <h1>
              Background

              
            </h1>
          </div>
          <div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
            
            
          </div></div></div>
        </div></div>
      </div>
      
      <div id="content">
          <div class="wrapper">


</div>
          <div class="wrapper">
<ul>
  <li>
<a href="#background" class="fancy-link wiki-link">Background</a>
    <ul>
      <li>
<a href="#systems-architecture" class="fancy-link wiki-link">Systems Architecture</a>
        <ul>
          <li><a href="#assembly" class="fancy-link wiki-link">Assembly</a></li>
          <li><a href="#atomic-operations" class="fancy-link wiki-link">Atomic Operations</a></li>
          <li><a href="#caching" class="fancy-link wiki-link">Caching</a></li>
          <li><a href="#interrupts" class="fancy-link wiki-link">Interrupts</a></li>
          <li><a href="#extra-out-of-order-instructions" class="fancy-link wiki-link">Extra: Out of order instructions</a></li>
          <li><a href="#optional-hyperthreading" class="fancy-link wiki-link">Optional: Hyperthreading</a></li>
        </ul>
      </li>
      <li>
<a href="#debugging-and-environments" class="fancy-link wiki-link">Debugging and Environments</a>
        <ul>
          <li><a href="#ssh" class="fancy-link wiki-link">ssh</a></li>
          <li><a href="#git" class="fancy-link wiki-link">git</a></li>
          <li><a href="#editors" class="fancy-link wiki-link">Editors</a></li>
          <li><a href="#clean-code" class="fancy-link wiki-link">clean code</a></li>
          <li><a href="#asserts" class="fancy-link wiki-link">Asserts</a></li>
        </ul>
      </li>
      <li>
<a href="#valgrind" class="fancy-link wiki-link">Valgrind</a>
        <ul>
          <li><a href="#tsan" class="fancy-link wiki-link">TSAN</a></li>
        </ul>
      </li>
      <li>
<a href="#gdb" class="fancy-link wiki-link">GDB</a>
        <ul>
          <li><a href="#setting-breakpoints-programmatically" class="fancy-link wiki-link">Setting breakpoints programmatically</a></li>
          <li><a href="#checking-memory-content" class="fancy-link wiki-link">Checking memory content</a></li>
          <li><a href="#undefined-behavior-sanitizer" class="fancy-link wiki-link">Undefined Behavior Sanitizer</a></li>
          <li><a href="#clang-static-build-tools" class="fancy-link wiki-link">Clang Static Build Tools</a></li>
          <li><a href="#strace-and-ltrace" class="fancy-link wiki-link">strace and ltrace</a></li>
          <li><a href="#printfs" class="fancy-link wiki-link">printfs</a></li>
        </ul>
      </li>
      <li>
<a href="#homework-0" class="fancy-link wiki-link">Homework 0</a>
        <ul>
          <li><a href="#so-you-want-to-master-system-programming-and-get-a-better-grade-than-b" class="fancy-link wiki-link">So you want to master System Programming? And get a better grade than B?</a></li>
          <li><a href="#watch-the-videos-and-write-up-your-answers-to-the-following-questions" class="fancy-link wiki-link">Watch the videos and write up your answers to the following questions</a></li>
          <li><a href="#chapter-1" class="fancy-link wiki-link">Chapter 1</a></li>
          <li><a href="#chapter-2" class="fancy-link wiki-link">Chapter 2</a></li>
          <li><a href="#chapter-3" class="fancy-link wiki-link">Chapter 3</a></li>
          <li><a href="#chapter-4" class="fancy-link wiki-link">Chapter 4</a></li>
          <li><a href="#chapter-5" class="fancy-link wiki-link">Chapter 5</a></li>
          <li><a href="#c-development" class="fancy-link wiki-link">C Development</a></li>
          <li><a href="#optional-just-for-fun" class="fancy-link wiki-link">Optional: Just for fun</a></li>
        </ul>
      </li>
      <li>
<a href="#uiuc-specific-guidlines" class="fancy-link wiki-link">UIUC Specific Guidlines</a>
        <ul>
          <li><a href="#piazza" class="fancy-link wiki-link">Piazza</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>[1][] <span> </span></p>



<div class="pad"><div class="card">
<div class="title"><h2 id="systems-architecture" class="title-text">Systems Architecture<a class="anchor title-text" href="#systems-architecture">#</a>
</h2></div>



















































<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<p>This section is a short review of System Architecture topics that you’ll need for System Programming.</p>
<h3 id="assembly" class="title-text">Assembly</h3>
<p>What is assembly? Assumbly is the lowest that you’ll get to machine language without writing 1’s and 0’s. Each computer has an architecture, and that architecture has an associated assembly language. Each assembly command has a 1:1 mapping to a set of 1’s and 0’s that tell the computer exactly what to do. For example the following in the widely used x86 Assembly language add one to the memory address 20.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>add BYTE PTR [0x20], 1
</code></pre></div></div>
<p>Why do we mention this? Because it is important that although you are going to be doing most of this class in C That this is what the code is translated into. Serious implications arise for race conditions and atomic operations.</p>
<h3 id="atomic-operations" class="title-text">Atomic Operations</h3>
<p>An operation is atomic if no other processor should interrupt it. Take for example the above assembly code to add one to a register. In the architecture, it may actually have a few different steps on the circuit. The operation may start by fetching the value of the memory from the stick of ram, then storing it in the cache or a register, and then finally writing back. The problem comes in if two processors try to do it at the same time. The two processors could (at the same time) copy the value of the memory address, add one, and store the same result back. Resulting in the value only being incremented once. That is why we have a special set of instructions on modern systems called atomic operations. If an instruction is atomic, it makes sure that only one processor or thread performs any intermediate step at a time. With x86 this is done by the <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/2/lock" class="fancy-link">lock</a></code></span> prefix.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lock add BYTE PTR [0x20], 1
</code></pre></div></div>
<p>Why don’t we do this for everything? It makes commands slower! If every time a computer does something it has to make sure that the other cores or processors aren’t doing anything, it’ll be much slower. Most of the time we differentiate these.</p>
<h3 id="caching" class="title-text">Caching</h3>
<p>Ah yes Caching. One of computer science’s greatest problems. Caching that we are referring is processor caching. Whenever you do a memory access if the particular address is already in the cache then the processor will perform the operation on the cache (such as adding) and update the actual memory later because updating memory is slow. If it isn’t, the processor requests a chunk of memory from the the memory chip and stores it in cache, kicking out the least recently used page (roughly). This is done because the processor cache is roughly ten times faster to reach than the memory in terms of time. Naturally this leads to problems because there are two different copies of the same value. This isn’t a class about caching, just know how this could impact your code.</p>
<h3 id="interrupts" class="title-text">Interrupts</h3>
<p>Interrupts are a very important part of system programming. An interrupt is internally an electrical signal that is delivered to the processor when something happens – this is hardware interrupt. Then the hardware decides if this is something that it should handle (i.e. handling keyboard or mouse input for older keyboard and mouses) or it should pass to the operating system. The operating system then decides if this is something that it should handle (i.e. paging a memory table from disk) or something the application should handle (i.e. a SEGFAULT). The application then decides if it is an error (SEGFAULT) or not (SIGPIPE for example) and reports to the user. Applications can also send signals to the kernel and to the hardware as well.</p>
<p>An important application of this is this is how system calls are served! There is a well established set of registers that the arguments go in according to the kernel as well as a system call “number” again defined by the kernel. Then the operating system triggers an interrupt which the kernel catches and serves the system call.</p>
<h3 id="extra-out-of-order-instructions" class="title-text">Extra: Out of order instructions</h3>
<p>For those of you who have and haven’t taken the systems architecture course, you may not have heard about out of order instruction execution. Out of order execution is an amazing development by processors recently. Processors now instead of executing a sequence of instructions (let’s say assigning a variable and then another variable) execute instructions before the current one is done. This is because modern processors spend a lot of time waiting for memory accesses and other I/O driven applications. This means that a processor while it is waiting for an operation to complete will execute the next few operations. If any of the operations would possibly alter the previous operation or there is a barrier, the processor will not reorder the instructions.</p>
<p>This naturally has allowed CPUs to become more energy efficient while executing more instructions in real time but naturally comes with security risks and more complex architectures. Where system programmers are worried is that (this is discussed in later chapters) operationg with mutex locks among threads are out of order – meaning that a software implementation of a mutex will not work without copious memory barriers. Basically, the programmer has to adopt the mental model of updates may not be seen among a series of threads without a barrier on modern processors.</p>
<p>One of the most prominent bugs with respect to this is Spectre. Spectre is a bug where instructions that otherwise wouldn’t be executed are due to out of order instruction execution. Here is an example</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kt">char</span> <span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span> 
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xCAFE</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// This will be in a register</span>
  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// This will be in main memory</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">,</span> <span class="o">--</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">val</span> <span class="o">=</span> <span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div></div>
<p>Let’s anaylze this code. The first loop allocates 9 elements through a valid malloc. The last element is <span><code class="highlighter-rouge">0xCAFE</code></span>, meaning a dereference should result in a segfault. For the first 9 iterations, the branch is taken and the second branch in the dereference (the question mark) also returns the first value. The interesting part happens in the last iteration. The resulting behavior of the program is to skip the last iteration and <span><code class="highlighter-rouge">val</code></span> never gets asisgned the last previous value.</p>
<p>But under the right compilation conditions and compiler flags, the instructions will get out of order executed. The processor thinks that the branch will be taken – it has been taken in the last 9 iterations. As such the processor will load that code up. Due to out of order instruction execution, while the value of i is being fetched from memory – we have to force it not to be in a register – the processor will try to dereference that address. Naturally that should result in a segfault, but since the address was never logically reached by the program the result is just discarded.</p>
<p>Now here is the trick. Even though the value of the calculation would’ve resulted in a segfault, the bug doesn’t clear the cache that refers to the physical memory where 0xCAFE is located (this not an exact explanation, but essentially how it works) Since it is still in the cache, if you again trick the processor to read form the cache using <span><code class="highlighter-rouge">val</code></span> then you will read a memory value that you wouldn’t be able to read normally. This includes important information like passwords, payment info etc etc.</p>
<h3 id="optional-hyperthreading" class="title-text">Optional: Hyperthreading</h3>
<p>Hyperthreading is a new technology and is in no way shape or form multithreading. Hyperthreading is allowing one physical core appear as many virtual cores to the operating system The operating system can then schedule processes on these virtual cores and one core will execute them. Each core interleaves processes. While the core is waiting for one memory access to complete, it may perform a few instructions of another process. The overal result is more instructions executed in a shorter time. This is also potentially means that you can divide the number of cores you need to power smaller devices.</p>
<p>There be dragons here though. With hyperthreading, you must be wary of optimizations. A famous hyperthreading bug that caused programs to crash if at least two processes was scheduled on a physical core, using specific registers, in a tight loop. The actual problem is better explained through an architecture lens. But, the actual application was found through systems programmers working on OCaml’s mainline. <a href="http://gallium.inria.fr/blog/intel-skylake-bug/" class="fancy-link wiki-link">http://gallium.inria.fr/blog/intel-skylake-bug/</a></p>
</div></div></div>
</div></div>
<div class="pad"><div class="card">
<div class="title"><h2 id="debugging-and-environments" class="title-text">Debugging and Environments<a class="anchor title-text" href="#debugging-and-environments">#</a>
</h2></div>























































































<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<p>I’m going to tell you a secret about this course: it is about working smarter <em>not</em> harder. The course can be time consuming but the reason that so many people see it as such (and why so many student’s don’t see it as such) is the relative familiarity of people with their tools. Let’s go through some of the common tools that you’ll be working on and need to be familiar with.</p>
<h3 id="ssh" class="title-text">ssh</h3>
<p><code class="highlighter-rouge"><a href="https://linux.die.net/man/3/ssh" class="fancy-link">ssh</a></code> is short for the Secure Shell. It is a network protocol that allows you to spawn a shell on a remote machine. Most of the times in this class you will need to ssh into your VM like this</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; ssh netid@sem-cs241-VM.cs.illinois.edu
</code></pre></div></div>
<p>If you don’t want to type your password out every time, you can generate an ssh key that uniquely identifies your machine. If you already have a key pair, you can skip to the copy id stage.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &gt; ssh-keygen -t rsa -b 4096
  # Do whatever keygen tells you
  # Don't feel like you need a passcode if your login password is secure
  &gt; ssh-copy-id netid@sem-cs241-VM.cs.illinois.edu
  # Enter your password for maybe the final time
  &gt; ssh  netid@sem-cs241-VM.cs.illinois.edu
</code></pre></div></div>
<p>If you still think that that is too much typing, you can always alias hosts. You may need to restart your VM or reload sshd for this to take effect. The config file is available on linux and mac distros. For windows you’ll have to use the Windows Linux Subsystem or configure any aliases in PuTTY</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; cat ~/.ssh/config
Host vm
  User          netid
  HostName      sem-cs241-VM.cs.illinois.edu
&gt; ssh vm
</code></pre></div></div>
<h3 id="git" class="title-text">git</h3>
<p>What is ‘git‘? Git is a version control system. What that means is git stores the entire history of a directory. We refer to the directory as a repository. So what do you need to know is a few things. First, create your repository with the repo creator. If you haven’t already signed into enterprise github, make sure to do so otherwise your repository won’t be created for you. After that, that means your repository is created on the server. Git is a decentralized version control system, meaning that you’ll need to get a repository onto your VM. We can do this with a clone. Whatever you do, <strong>do not go through the README.md tutorial</strong>.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git clone https://github-dev.cs.illinois.edu/cs241-fa18/&lt;netid&gt;.git
</code></pre></div></div>
<p>This will create a local repsitory. The workflow is you make a change on your local repository, add the changes to a current commit, actually commit, and push the changes to the server.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ # edit the file, maybe using vim
$ git add &lt;file&gt;
$ git commit -m "Committing my file"
$ git push origin master
</code></pre></div></div>
<p>Now to explain git well, you need to understand that git for our purposes will look like a linked list. You will always be at the head of master, and you will do the edit-add-commit-push loop. We have a separate branch on github that we push feedback to under a specific branch which you can view on github website. The markdown file will have information on the test cases and results (like standard out).</p>
<p>Every so often git can break. Here are a list of commands you probably won’t need to fix your repo</p>
<ol>
  <li>
    <p>git-cherry-pick</p>
  </li>
  <li>
    <p>git-pack</p>
  </li>
  <li>
    <p>git-gc</p>
  </li>
  <li>
    <p>git-clean</p>
  </li>
  <li>
    <p>git-rebase</p>
  </li>
  <li>
    <p>git-stash/git-apply/git-pop</p>
  </li>
  <li>
    <p>git-branch</p>
  </li>
</ol>
<p>In addition if you are currently on a branch, and you don’t see either</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git status
On branch master
Your branch is up-to-date with 'origin/master'.
nothing to commit, working directory clean
</code></pre></div></div>
<p>or</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git status
On branch master
Your branch is up-to-date with 'origin/master'.
Changes not staged for commit:
  (use "git add &lt;file&gt;..." to update what will be committed)
  (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)

        modified:   &lt;FILE&gt;
        ...

no changes added to commit (use "git add" and/or "git commit -a")
</code></pre></div></div>
<p>And something like</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git status
HEAD detached at 4bc4426
nothing to commit, working directory clean
</code></pre></div></div>
<p>Don’t panic, but your repository may be in an unworkable state. If you aren’t nearing a deadline, come in to office hours or ask your question on Piazza, and we’d be happy to help. In an emergency scenario, delete your repository and re-clone (you’ll have to add the <code class="highlighter-rouge">release</code> as above). <strong>This will lose any local uncommitted changes. Make sure to copy any files you were working on outside the directory, remove and copy them back in</strong></p>
<h3 id="editors" class="title-text">Editors</h3>
<p>Some people take this as an opportunity to learn a new editor, others not so much. The first part is those of you who want to learn a new editor. In the editor war that spans decades, we have come to the battle of vim vs emacs.</p>
<p>Vim is a text editor and unix-like utilty. You enter vim by typing <code class="highlighter-rouge">vim &lt;file&gt;</code>. This takes you into the editor. You start off in normal mode. In this mode you can move around with many keys with the most common ones being <code class="highlighter-rouge">jklh</code>. To exit vim from this mode, you need to type <code class="highlighter-rouge">:q</code> which quits. If you have any unsaved edits, you must either save them <code class="highlighter-rouge">:w</code>, save and quit <code class="highlighter-rouge">:wq</code>, or discard changes <code class="highlighter-rouge">:q!</code>. To make edits you can either type <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/i" class="fancy-link">i</a></code> to change you into insert mode or <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/a" class="fancy-link">a</a></code> to change to insert mode <strong>a</strong>fter the cursor. This is the very basics when it comes to vim</p>
<p>Emacs is more of a way of life, and I don’t mean that figuratively. A lot people when they switch to the emacs environment realize that it is a powerful operating system lacking a decent text editor. This means emacs can house a terminal, gdb session, ssh session, code and a whole lot more. It would not be fitting any other way to introduce you the gnu-emacs any other way than the gnu-docs . Just note that emacs is <em>insanely</em> powerful. You can do almost anything with it. There are a fair number of students who like the IDE-aspect of other programming languages, just know you can set up emacs to be an IDE, but you have to learn a bit of lisp .</p>
<p>Then there are those of you who like to use your own editors. That is completely fine. For this we require sshfs which has ports on many different machines</p>
<ol>
  <li>
    <p>Windows</p>
  </li>
  <li>
    <p>Mac</p>
  </li>
  <li>
    <p>Linux</p>
  </li>
</ol>
<p>At that point the files on your VM are synced with the files on your machine and edits can be made and will be sync’ed</p>
<p>At the time of writing, Bhuvy (That’s me!) really likes to use spacemacs which marries both vim and emacs and both of their difficulties. I’ll give my soapbox for why I like it, but be warned that if you are starting from absolutely no vim or emacs experience the learning curve along with this course may be too much.</p>
<ol>
  <li>
    <p>Extensible. Spacemacs has a clean design written in lisp. There are 100s of packages ready to be installed by editing your spacemacs config and reloading that do everything from syntax checking, automatic static analyzing, etc etc.</p>
  </li>
  <li>
    <p>Most of the good parts from vim and emacs. Emacs is really good at doing everything buy being a fast editor. Vim is really good at making fast edits and moving around. Spacemacs is the best of both worlds allowing vim keybindings with all the emacs goodness underneath.</p>
  </li>
  <li>
    <p>Lots of preconfiguration done. As opposed with a fresh emacs install, a lot of the configurations with langauge and projects are done for you like neotree, helm, various language layers. All they you have to do is navigate neotree to the base of your project and emacs will turn into an IDE for that programming language.</p>
  </li>
</ol>
<h3 id="clean-code" class="title-text">clean code</h3>
<p>Make your code modular using helper functions. If there is a repeated task (getting the pointers to contiguous blocks in the malloc MP, for example), make them helper functions. And make sure each function does one thing very well, so that you don’t have to debug twice. Let’s say that we are doing selection sort by finding the minimum element each iteration like so,</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">selection_sort</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">long</span> <span class="n">len</span><span class="p">){</span>
     <span class="k">for</span><span class="p">(</span><span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="n">len</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">){</span>
         <span class="kt">long</span> <span class="n">max_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
         <span class="k">for</span><span class="p">(</span><span class="kt">long</span> <span class="n">j</span> <span class="o">=</span> <span class="n">len</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">j</span><span class="p">){</span>
             <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">max_index</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]){</span>
                  <span class="n">max_index</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
             <span class="p">}</span>
         <span class="p">}</span>
         <span class="kt">int</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
         <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">max_index</span><span class="p">];</span>
         <span class="n">a</span><span class="p">[</span><span class="n">max_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
     <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>
<p>Many can see the bug in the code, but it can help to refactor the above method into</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">long</span> <span class="n">max_index</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">long</span> <span class="n">start</span><span class="p">,</span> <span class="kt">long</span> <span class="n">end</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">swap</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">long</span> <span class="n">idx1</span><span class="p">,</span> <span class="kt">long</span> <span class="n">idx2</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">selection_sort</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">long</span> <span class="n">len</span><span class="p">);</span>
</code></pre></div></div>
<p>And the error is specifically in one function. In the end, we are not a class about refactoring/debugging your code. In fact, most kernel code is so atrocious that you don’t want to read it. But for the sake of debugging, it may benefit you in the long run to adopt some of these practices.</p>
<h3 id="asserts" class="title-text">Asserts</h3>
<p>Use assertions to make sure your code works up to a certain point – and importantly, to make sure you don’t break it later. For example, if your data structure is a doubly linked list, you can do something like <code class="highlighter-rouge">assert(node == node-&gt;next-&gt;prev)</code> to assert that the next node has a pointer to the current node. You can also check the pointer is pointing to an expected range of memory address, not null, -&gt;size is reasonable etc. The <code class="highlighter-rouge">NDEBUG</code> macro will disable all assertions, so don’t forget to set that once you finish debugging. <a href="http://www.cplusplus.com/reference/cassert/assert/" class="fancy-link wiki-link">assert link</a></p>
<p>Here’s a quick example with assert. Let’s say that I’m writing code using memcpy</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">assert</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">src</span> <span class="o">&lt;</span> <span class="n">dest</span><span class="o">+</span><span class="n">n</span> <span class="o">&amp;&amp;</span> <span class="n">dest</span> <span class="o">&lt;</span> <span class="n">src</span><span class="o">+</span><span class="n">n</span><span class="p">));</span> <span class="c1">//Checks overlap</span>
<span class="n">memcpy</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
</code></pre></div></div>
<p>This check can be turned off at compile time, but will save you <strong>tons</strong> of trouble debugging!</p>
</div></div></div>
</div></div>
<div class="pad"><div class="card">
<div class="title"><h2 id="valgrind" class="title-text">Valgrind<a class="anchor title-text" href="#valgrind">#</a>
</h2></div>

































<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<p>Valgrind is a suite of tools designed to provide debugging and profiling tools to make your programs more correct and detect some runtime issues. The most used of these tools is Memcheck, which can detect many memory-related errors that are common in C and C++ programs and that can lead to crashes and unpredictable behaviour (for example, unfreed memory buffers). To run Valgrind on your program:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">valgrind</span> <span class="o">--</span><span class="n">leak</span><span class="o">-</span><span class="n">check</span><span class="o">=</span><span class="n">full</span> <span class="o">--</span><span class="n">show</span><span class="o">-</span><span class="n">leak</span><span class="o">-</span><span class="n">kinds</span><span class="o">=</span><span class="n">all</span> <span class="n">myprogram</span> <span class="n">arg1</span> <span class="n">arg2</span>
</code></pre></div></div>
<p>Arguments are optional and the default tool that will run is Memcheck. The output will be presented in form of number of allocations, number of freed allocations, and the number of errors.Suppose we have a simple program like this:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdlib.h&gt;
</span>
<span class="kt">void</span> <span class="nf">dummy_function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span><span class="o">*</span> <span class="n">x</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>        <span class="c1">// error 1:as you can see here we write to an out of bound memory address</span>
<span class="p">}</span>                    <span class="c1">// error 2: memory leak the allocated x not freed</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">dummy_function</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>This program compiles and run with no errors. Let’s see what Valgrind will output.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">==</span><span class="mi">29515</span><span class="o">==</span> <span class="n">Memcheck</span><span class="p">,</span> <span class="n">a</span> <span class="n">memory</span> <span class="n">error</span> <span class="n">detector</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span> <span class="n">Copyright</span> <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="mi">2002</span><span class="o">-</span><span class="mi">2015</span><span class="p">,</span> <span class="n">and</span> <span class="n">GNU</span> <span class="n">GPL</span><span class="err">'</span><span class="n">d</span><span class="p">,</span> <span class="n">by</span> <span class="n">Julian</span> <span class="n">Seward</span> <span class="n">et</span> <span class="n">al</span><span class="p">.</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span> <span class="n">Using</span> <span class="n">Valgrind</span><span class="o">-</span><span class="mi">3</span><span class="p">.</span><span class="mi">11</span><span class="p">.</span><span class="mi">0</span> <span class="n">and</span> <span class="n">LibVEX</span><span class="p">;</span> <span class="n">rerun</span> <span class="n">with</span> <span class="o">-</span><span class="n">h</span> <span class="k">for</span> <span class="n">copyright</span> <span class="n">info</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span> <span class="n">Command</span><span class="o">:</span> <span class="p">.</span><span class="o">/</span><span class="n">a</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span> 
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span> <span class="n">Invalid</span> <span class="n">write</span> <span class="n">of</span> <span class="n">size</span> <span class="mi">4</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span>    <span class="n">at</span> <span class="mh">0x400544</span><span class="o">:</span> <span class="n">dummy_function</span> <span class="p">(</span><span class="n">in</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">rafi</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">exocpp</span><span class="o">/</span><span class="n">a</span><span class="p">)</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span>    <span class="n">by</span> <span class="mh">0x40055A</span><span class="o">:</span> <span class="n">main</span> <span class="p">(</span><span class="n">in</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">rafi</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">exocpp</span><span class="o">/</span><span class="n">a</span><span class="p">)</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span>  <span class="n">Address</span> <span class="mh">0x5203068</span> <span class="n">is</span> <span class="mi">0</span> <span class="n">bytes</span> <span class="n">after</span> <span class="n">a</span> <span class="n">block</span> <span class="n">of</span> <span class="n">size</span> <span class="mi">40</span> <span class="n">alloc</span><span class="err">'</span><span class="n">d</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span>    <span class="n">at</span> <span class="mh">0x4C2DB8F</span><span class="o">:</span> <span class="n">malloc</span> <span class="p">(</span><span class="n">in</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">valgrind</span><span class="o">/</span><span class="n">vgpreload_memcheck</span><span class="o">-</span><span class="n">amd64</span><span class="o">-</span><span class="n">linux</span><span class="p">.</span><span class="n">so</span><span class="p">)</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span>    <span class="n">by</span> <span class="mh">0x400537</span><span class="o">:</span> <span class="n">dummy_function</span> <span class="p">(</span><span class="n">in</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">rafi</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">exocpp</span><span class="o">/</span><span class="n">a</span><span class="p">)</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span>    <span class="n">by</span> <span class="mh">0x40055A</span><span class="o">:</span> <span class="n">main</span> <span class="p">(</span><span class="n">in</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">rafi</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">exocpp</span><span class="o">/</span><span class="n">a</span><span class="p">)</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span> 
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span> 
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span> <span class="n">HEAP</span> <span class="n">SUMMARY</span><span class="o">:</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span>     <span class="n">in</span> <span class="n">use</span> <span class="n">at</span> <span class="n">exit</span><span class="o">:</span> <span class="mi">40</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">1</span> <span class="n">blocks</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span>   <span class="n">total</span> <span class="n">heap</span> <span class="n">usage</span><span class="o">:</span> <span class="mi">1</span> <span class="n">allocs</span><span class="p">,</span> <span class="mi">0</span> <span class="n">frees</span><span class="p">,</span> <span class="mi">40</span> <span class="n">bytes</span> <span class="n">allocated</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span> 
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span> <span class="n">LEAK</span> <span class="n">SUMMARY</span><span class="o">:</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span>    <span class="n">definitely</span> <span class="n">lost</span><span class="o">:</span> <span class="mi">40</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">1</span> <span class="n">blocks</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span>    <span class="n">indirectly</span> <span class="n">lost</span><span class="o">:</span> <span class="mi">0</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">0</span> <span class="n">blocks</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span>      <span class="n">possibly</span> <span class="n">lost</span><span class="o">:</span> <span class="mi">0</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">0</span> <span class="n">blocks</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span>    <span class="n">still</span> <span class="n">reachable</span><span class="o">:</span> <span class="mi">0</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">0</span> <span class="n">blocks</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span>         <span class="n">suppressed</span><span class="o">:</span> <span class="mi">0</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">0</span> <span class="n">blocks</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span> <span class="n">Rerun</span> <span class="n">with</span> <span class="o">--</span><span class="n">leak</span><span class="o">-</span><span class="n">check</span><span class="o">=</span><span class="n">full</span> <span class="n">to</span> <span class="n">see</span> <span class="n">details</span> <span class="n">of</span> <span class="n">leaked</span> <span class="n">memory</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span> 
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span> <span class="n">For</span> <span class="n">counts</span> <span class="n">of</span> <span class="n">detected</span> <span class="n">and</span> <span class="n">suppressed</span> <span class="n">errors</span><span class="p">,</span> <span class="n">rerun</span> <span class="n">with</span><span class="o">:</span> <span class="o">-</span><span class="n">v</span>
<span class="o">==</span><span class="mi">29515</span><span class="o">==</span> <span class="n">ERROR</span> <span class="n">SUMMARY</span><span class="o">:</span> <span class="mi">1</span> <span class="n">errors</span> <span class="n">from</span> <span class="mi">1</span> <span class="n">contexts</span> <span class="p">(</span><span class="n">suppressed</span><span class="o">:</span> <span class="mi">0</span> <span class="n">from</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>
<p><strong>Invalid write</strong>: It detected our heap block overrun, writing outside of allocated block.</p>
<p><strong>Definitely lost</strong>: Memory leak — you probably forgot to free a memory block.</p>
<p>Valgrind is a very effective tool to check for errors at runtime. C is very special when it comes to such behavior, so after compiling your program you can use Valgrind to fix errors that your compiler may not catch and that usually happen when your program is running.</p>
<p>For more information, you can refer to the <a href="http://valgrind.org/docs/manual/quick-start.html" class="fancy-link wiki-link">valgrind website</a>.</p>
<h3 id="tsan" class="title-text">TSAN</h3>
<p>ThreadSanitizer is a tool from Google, built into clang and gcc, to help you detect race conditions in your code. For more information about the tool, see the Github wiki. Note, that running with tsan will slow your code down a bit. Consider the following code.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;pthread.h&gt;
#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="n">global</span><span class="p">;</span>

<span class="kt">void</span> <span class="o">*</span><span class="nf">Thread1</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">global</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">pthread_t</span> <span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">Thread1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">global</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="n">pthread_join</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// compile with gcc -fsanitize=thread -pie -fPIC -ltsan -g simple_race.c</span>
</code></pre></div></div>
<p>We can see that there is a race condition on the variable <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/global" class="fancy-link">global</a></code>. Both the main thread and the thread created with will try to change the value at the same time. But, does ThreadSantizer catch it?</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">a</span><span class="p">.</span><span class="n">out</span>
<span class="o">==================</span>
<span class="n">WARNING</span><span class="o">:</span> <span class="n">ThreadSanitizer</span><span class="o">:</span> <span class="n">data</span> <span class="n">race</span> <span class="p">(</span><span class="n">pid</span><span class="o">=</span><span class="mi">28888</span><span class="p">)</span>
  <span class="n">Read</span> <span class="n">of</span> <span class="n">size</span> <span class="mi">4</span> <span class="n">at</span> <span class="mh">0x7f73ed91c078</span> <span class="n">by</span> <span class="kr">thread</span> <span class="n">T1</span><span class="o">:</span>
    <span class="cp">#0 Thread1 /home/zmick2/simple_race.c:7 (exe+0x000000000a50)
</span>    <span class="cp">#1  :0 (libtsan.so.0+0x00000001b459)
</span>
  <span class="n">Previous</span> <span class="n">write</span> <span class="n">of</span> <span class="n">size</span> <span class="mi">4</span> <span class="n">at</span> <span class="mh">0x7f73ed91c078</span> <span class="n">by</span> <span class="n">main</span> <span class="kr">thread</span><span class="o">:</span>
    <span class="cp">#0 main /home/zmick2/simple_race.c:14 (exe+0x000000000ac8)
</span>
  <span class="n">Thread</span> <span class="n">T1</span> <span class="p">(</span><span class="n">tid</span><span class="o">=</span><span class="mi">28889</span><span class="p">,</span> <span class="n">running</span><span class="p">)</span> <span class="n">created</span> <span class="n">by</span> <span class="n">main</span> <span class="kr">thread</span> <span class="n">at</span><span class="o">:</span>
    <span class="cp">#0  :0 (libtsan.so.0+0x00000001f6ab)
</span>    <span class="cp">#1 main /home/zmick2/simple_race.c:13 (exe+0x000000000ab8)
</span>
<span class="n">SUMMARY</span><span class="o">:</span> <span class="n">ThreadSanitizer</span><span class="o">:</span> <span class="n">data</span> <span class="n">race</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">zmick2</span><span class="o">/</span><span class="n">simple_race</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">7</span> <span class="n">Thread1</span>
<span class="o">==================</span>
<span class="n">ThreadSanitizer</span><span class="o">:</span> <span class="n">reported</span> <span class="mi">1</span> <span class="n">warnings</span>
</code></pre></div></div>
<p>If we compiled with the debug flag, then it would give us the variable name as well.</p>
</div></div></div>
</div></div>
<div class="pad"><div class="card">
<div class="title"><h2 id="gdb" class="title-text">GDB<a class="anchor title-text" href="#gdb">#</a>
</h2></div>



<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<p><a href="http://www.cs.cmu.edu/~gilpin/tutorial/" class="fancy-link wiki-link">Introduction to gdb</a></p>
<div class="pad"><div class="card">
<h5 id="setting-breakpoints-programmatically">Setting breakpoints programmatically</h5>

<p>A very useful trick when debugging complex C programs with GDB is setting breakpoints in the source code.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">val</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
    <span class="n">asm</span><span class="p">(</span><span class="s">"int $3"</span><span class="p">);</span> <span class="c1">// set a breakpoint here</span>
    <span class="n">val</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">gcc</span> <span class="n">main</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span><span class="n">g</span> <span class="o">-</span><span class="n">o</span> <span class="n">main</span> <span class="o">&amp;&amp;</span> <span class="p">.</span><span class="o">/</span><span class="n">main</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">r</span>
<span class="p">[...]</span>
<span class="n">Program</span> <span class="n">received</span> <span class="n">signal</span> <span class="n">SIGTRAP</span><span class="p">,</span> <span class="n">Trace</span><span class="o">/</span><span class="n">breakpoint</span> <span class="n">trap</span><span class="p">.</span>
<span class="n">main</span> <span class="p">()</span> <span class="n">at</span> <span class="n">main</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">6</span>
<span class="mi">6</span>     <span class="n">val</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">p</span> <span class="n">val</span>
<span class="err">$</span><span class="mi">1</span> <span class="o">=</span> <span class="mi">42</span>
</code></pre></div></div>

</div></div>
<div class="pad"><div class="card">
<h5 id="checking-memory-content">Checking memory content</h5>

<p><a href="http://www.delorie.com/gnu/docs/gdb/gdb_56.html" class="fancy-link wiki-link">Memory Content</a></p>

<p>For example,</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">bad_string</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="sc">'C'</span><span class="p">,</span> <span class="sc">'a'</span><span class="p">,</span> <span class="sc">'t'</span><span class="p">};</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">bad_string</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gcc main.c -g -o main &amp;&amp; ./main
$ Cat ZVQ� $

(gdb) l
1 #include &lt;stdio.h&gt;
2 int main() {
3     char bad_string[3] = {'C', 'a', 't'};
4     printf("%s", bad_string);
5 }
(gdb) b 4
Breakpoint 1 at 0x100000f57: file main.c, line 4.
(gdb) r
[...]
Breakpoint 1, main () at main.c:4
4     printf("%s", bad_string);
(gdb) x/16xb bad_string
0x7fff5fbff9cd: 0x63  0x61  0x74  0xe0  0xf9  0xbf  0x5f  0xff
0x7fff5fbff9d5: 0x7f  0x00  0x00  0xfd  0xb5  0x23  0x89  0xff

(gdb)
</code></pre></div></div>

<p>Here, by using the <code class="highlighter-rouge">x</code> command with parameters <code class="highlighter-rouge">16xb</code>, we can see that starting at memory address <code class="highlighter-rouge">0x7fff5fbff9c</code> (value of <code class="highlighter-rouge">bad_string</code>), <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/printf" class="fancy-link">printf</a></code> would actually see the following sequence of bytes as a string because we provided a malformed string without a null terminator.</p>

<p>What do you actually use to run your program? A shell! A shell is a programming language that is running inside your terminal. A terminal is merely a window to input commands. Now, on POSIX we usually have one shell called <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/1/sh" class="fancy-link">sh</a></code></span> that is linked to a POSIX compliant shell called <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/1/dash" class="fancy-link">dash</a></code></span>. Most of the time, you use a shell called <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/1/bash" class="fancy-link">bash</a></code></span> that is not entirely POSIX compliant but has some nifty built in features. If you want to be even more advanced, <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/1/zsh" class="fancy-link">zsh</a></code></span> has some more powerful features like tab complete on programs and fuzzy patterns, but that is neither here nor there.</p>

<h3 id="undefined-behavior-sanitizer" class="title-text">Undefined Behavior Sanitizer</h3>

<p>The undefined behavior sanitizer is a wonderful tool provided by the llvm project. It allows you to compile code witha runtime checker to make sure that you don’t do undefined behavior for various categories. We will try to include it into our projects, but requires support form all the external libraries that we use so we may not get around to all of them.</p>

</div></div>
<div class="pad"><div class="card">
<h4 id="undefined-behavior---why-we-cant-solve-it-in-general">Undefined behavior - why we can’t solve it in general</h4>

<p>Also please please read Chris Lattner’s 3 Part blog post on undefined behavior. It can shed light on debug builds and the mystery of compiler optimization.</p>

<h3 id="clang-static-build-tools" class="title-text">Clang Static Build Tools</h3>

<h3 id="strace-and-ltrace" class="title-text">strace and ltrace</h3>

<h3 id="printfs" class="title-text">printfs</h3>

<p>When all else fails, print! Each of your functions should have an idea of what it is going to do (ie find_min better find the minimum element). You want to test that each of your functions is doing what it set out to do and see exactly where your code breaks. In the case with race conditions, tsan may be able to help, but having each thread print out data at certain times could help you identify the race condition.</p>

<p>To make printfs useful, try to have a macro that fills in the context by which the printf was called – a log statement if you will. A simple useful but untested log statement could be as follows. Try to make a test and figure out something that is going wrong, then log the state of your variables.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="cp">#include &lt;execinfo.h&gt;
</span>  <span class="cp">#include &lt;stdio.h&gt;
</span>  <span class="cp">#include &lt;stdlib.h&gt;
</span>  <span class="cp">#include &lt;stdarg.h&gt;
</span>  <span class="cp">#include &lt;unistd.h&gt;
</span>  
  <span class="c1">// bt is print backtrace</span>
  <span class="k">const</span> <span class="kt">int</span> <span class="n">num_stack</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="kt">int</span> <span class="nf">__log</span><span class="p">(</span><span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">bt</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">bt</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">void</span> <span class="o">*</span><span class="n">raw_trace</span><span class="p">[</span><span class="n">num_stack</span><span class="p">];</span>
      <span class="kt">size_t</span> <span class="n">size</span> <span class="o">=</span> <span class="n">backtrace</span><span class="p">(</span><span class="n">raw_trace</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">raw_trace</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">raw_trace</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
      <span class="kt">char</span> <span class="o">**</span><span class="n">syms</span> <span class="o">=</span> <span class="n">backtrace_symbols</span><span class="p">(</span><span class="n">raw_trace</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>

      <span class="k">for</span><span class="p">(</span><span class="kt">ssize_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"|%s:%d| %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">syms</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="n">free</span><span class="p">(</span><span class="n">syms</span><span class="p">);</span> 
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"|%s:%d| "</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">);</span>
    <span class="kt">va_list</span> <span class="n">args</span><span class="p">;</span>
    <span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span> 
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">vfprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cp">#ifdef DEBUG
</span>  <span class="cp">#define log(...) __log(__LINE__, __FILE__, 0, __VA_ARGS__)
</span>  <span class="cp">#define bt(...) __log(__LINE__, __FILE__, 1, __VA_ARGS__)
</span>  <span class="cp">#else
</span>  <span class="cp">#define log(...)
</span>  <span class="cp">#define bt(...)
</span>  <span class="cp">#endif
</span>
  <span class="c1">//Use as log(args like printf) or bt(args like printf) to either log or get backtrace</span>

  <span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">log</span><span class="p">(</span><span class="s">"Hello Log"</span><span class="p">);</span>
    <span class="n">bt</span><span class="p">(</span><span class="s">"Hello Backtrace"</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>And then use as such.</p>

</div></div>
</div></div></div>
</div></div>
<div class="pad"><div class="card">
<div class="title"><h2 id="homework-0" class="title-text">Homework 0<a class="anchor title-text" href="#homework-0">#</a>
</h2></div>





























































<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// First, can you guess which lyrics have been transformed into this C-like system code?</span>
<span class="kt">char</span> <span class="n">q</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"Do you wanna build a C99 program?"</span><span class="p">;</span>
<span class="cp">#define or "go debugging with gdb?"
</span><span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">or</span><span class="p">)</span> <span class="o">!=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">or</span><span class="p">);</span>
<span class="kt">char</span><span class="o">*</span> <span class="n">ptr</span> <span class="o">=</span> <span class="s">"lathe"</span><span class="p">;</span> <span class="kt">size_t</span> <span class="n">come</span> <span class="o">=</span> <span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s">"%s door"</span><span class="p">,</span> <span class="n">ptr</span><span class="o">+</span><span class="mi">2</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">away</span> <span class="o">=</span> <span class="o">!</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span> <span class="s">""</span><span class="p">;</span>

<span class="kt">int</span><span class="o">*</span> <span class="n">shared</span> <span class="o">=</span> <span class="n">mmap</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">),</span> <span class="n">PROT_READ</span> <span class="o">|</span> <span class="n">PROT_WRITE</span><span class="p">,</span> <span class="n">MAP_SHARED</span> <span class="o">|</span> <span class="n">MAP_ANONYMOUS</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">munmap</span><span class="p">(</span><span class="n">shared</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">));</span>

<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">fork</span><span class="p">())</span> <span class="p">{</span> <span class="n">execlp</span><span class="p">(</span><span class="s">"man"</span><span class="p">,</span><span class="s">"man"</span><span class="p">,</span><span class="s">"-3"</span><span class="p">,</span><span class="s">"ftell"</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span> <span class="n">perror</span><span class="p">(</span><span class="s">"failed"</span><span class="p">);</span> <span class="p">}</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">fork</span><span class="p">())</span> <span class="p">{</span> <span class="n">execlp</span><span class="p">(</span><span class="s">"make"</span><span class="p">,</span><span class="s">"make"</span><span class="p">,</span> <span class="s">"snowman"</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span> <span class="n">execlp</span><span class="p">(</span><span class="s">"make"</span><span class="p">,</span><span class="s">"make"</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">));</span> <span class="p">}</span>

<span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</code></pre></div></div>
<h3 id="so-you-want-to-master-system-programming-and-get-a-better-grade-than-b" class="title-text">So you want to master System Programming? And get a better grade than B?</h3>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"Great! We have plenty of useful resources for you, but it's up to you to"</span><span class="p">);</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">" be an active learner and learn how to solve problems and debug code."</span><span class="p">);</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"Bring your near-completed answers the problems below"</span><span class="p">);</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">" to the first lab to show that you've been working on this."</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"A few </span><span class="se">\"</span><span class="s">don't knows</span><span class="se">\"</span><span class="s"> or </span><span class="se">\"</span><span class="s">unsure</span><span class="se">\"</span><span class="s"> is fine for lab 1.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span> 
    <span class="n">puts</span><span class="p">(</span><span class="s">"Warning: you and your peers will work hard in this class."</span><span class="p">);</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"This is not CS225; you will be pushed much harder to"</span><span class="p">);</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">" work things out on your own."</span><span class="p">);</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s">"This homework is a stepping stone to all future assignments.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="kt">char</span> <span class="n">p</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"So, you will want to clear up any confusions or misconceptions.</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">);</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="n">sprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="s">"For grading purposes, this homework 0 will be graded as part of your lab %d work.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Press Return to continue</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<h3 id="watch-the-videos-and-write-up-your-answers-to-the-following-questions" class="title-text">Watch the videos and write up your answers to the following questions</h3>
<p><strong>Important!</strong></p>
<p>The virtual machine-in-your-browser and the videos you need for HW0 are here:</p>
<p><a href="http://cs-education.github.io/sys/" class="fancy-link wiki-link">http://cs-education.github.io/sys/</a></p>
<p>Questions? Comments? Use the current semester’s CS241 Piazza: <a href="https://piazza.com/" class="fancy-link wiki-link">https://piazza.com/</a></p>
<p>The in-browser virtual machine runs entirely in Javascript and is fastest in Chrome. Note the VM and any code you write is reset when you reload the page, <strong>so copy your code to a separate document.</strong> The post-video challenges are not part of homework 0 but you learn the most by doing rather than just passively watching - so we suggest you have some fun with each end-of-video challenge.</p>
<p>HW0 questions are below. Copy your answers into a text document sd you’ll need to submit them later in the course.</p>
<h3 id="chapter-1" class="title-text">Chapter 1</h3>
<p>In which our intrepid hero battles standard out, standard error, file descriptors and writing to files</p>
<ol>
  <li>
    <p><strong>Hello, World! (system call style)</strong> Write a program that uses <span><code class="highlighter-rouge">write()</code></span> to print out “Hi! My name is &lt;Your Name&gt;”.</p>
  </li>
  <li>
    <p><strong>Hello, Standard Error Stream!</strong> Write a function to print out a triangle of height <span><code class="highlighter-rouge">n</code></span> to standard error. Your function should have the signature <span><code class="highlighter-rouge">void write_triangle(int n)</code></span> and should use <span><code class="highlighter-rouge">write()</code></span>. The triangle should look like this, for n = 3:</p>

    <div class="language-c highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="o">*</span>
<span class="o">**</span>
<span class="o">***</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Writing to files</strong> Take your program from “Hello, World!” modify it write to a file called <span><code class="highlighter-rouge">hello_world.txt</code></span>. Make sure to to use correct flags and a correct mode for <span><code class="highlighter-rouge">open()</code></span> (<span><code class="highlighter-rouge">man 2 open</code></span> is your friend).</p>
  </li>
  <li>
    <p><strong>Not everything is a system call</strong> Take your program from “Writing to files” and replace <span><code class="highlighter-rouge">write()</code></span> with <span><code class="highlighter-rouge">printf()</code></span>. <em>Make sure to print to the file instead of standard out!</em></p>
  </li>
  <li>
    <p>What are some differences between <span><code class="highlighter-rouge">write()</code></span> and <span><code class="highlighter-rouge">printf()</code></span>?</p>
  </li>
</ol>
<h3 id="chapter-2" class="title-text">Chapter 2</h3>
<p>Sizing up C types and their limits, <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/3/int" class="fancy-link">int</a></code></span> and <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/3/char" class="fancy-link">char</a></code></span> arrays, and incrementing pointers</p>
<ol>
  <li>
    <p>How many bits are there in a byte?</p>
  </li>
  <li>
    <p>How many bytes are there in a <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/3/char" class="fancy-link">char</a></code></span>?</p>
  </li>
  <li>
    <p>How many bytes the following are on your machine? <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/3/int" class="fancy-link">int</a></code></span>, <span><code class="highlighter-rouge">double</code></span>, <span><code class="highlighter-rouge">float</code></span>, <span><code class="highlighter-rouge">long</code></span>, and <span><code class="highlighter-rouge">long long</code></span></p>
  </li>
  <li>
    <p>On a machine with 8 byte integers, the declaration for the variable <span><code class="highlighter-rouge">data</code></span> is <span><code class="highlighter-rouge">int data[8]</code></span>. If the address of data is <span><code class="highlighter-rouge">0x7fbd9d40</code></span>, then what is the address of <span><code class="highlighter-rouge">data+2</code></span>?</p>
  </li>
  <li>
    <p>What is <span><code class="highlighter-rouge">data[3]</code></span> equivalent to in C? Hint: what does C convert <span><code class="highlighter-rouge">data[3]</code></span> to before dereferencing the address? Remember, the type of a string constant <span><code class="highlighter-rouge">abc</code></span> is an array.</p>
  </li>
  <li>
    <p>Why does this segfault?</p>

    <div class="language-c highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="s">"hello"</span><span class="p">;</span>
<span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="sc">'J'</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>What is the value of the variable <span><code class="highlighter-rouge">str_size</code></span>?</p>

    <div class="language-c highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kt">ssize_t</span> <span class="n">str_size</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="s">"Hello</span><span class="se">\0</span><span class="s">World"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>What is the value of the variable <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/3/str_len" class="fancy-link">str_len</a></code></span></p>

    <div class="language-c highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kt">ssize_t</span> <span class="n">str_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="s">"Hello</span><span class="se">\0</span><span class="s">World"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Give an example of X such that <span><code class="highlighter-rouge">sizeof(X)</code></span> is 3.</p>
  </li>
  <li>
    <p>Give an example of Y such that <span><code class="highlighter-rouge">sizeof(Y)</code></span> might be 4 or 8 depending on the machine.</p>
  </li>
</ol>
<h3 id="chapter-3" class="title-text">Chapter 3</h3>
<p>Program arguments, environment variables, and working with character arrays (strings)</p>
<ol>
  <li>
    <p>What are two ways to find the length of <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/3/argv" class="fancy-link">argv</a></code></span>?</p>
  </li>
  <li>
    <p>What does <span><code class="highlighter-rouge">argv[0]</code></span> represent?</p>
  </li>
  <li>
    <p>Where are the pointers to environment variables stored (on the stack, the heap, somewhere else)?</p>
  </li>
  <li>
    <p>On a machine where pointers are 8 bytes, and with the following code:</p>

    <div class="language-c highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="s">"Hello"</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">array</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"Hello"</span><span class="p">;</span>
</code></pre></div>    </div>

    <p>What are the values of <span><code class="highlighter-rouge">sizeof(ptr)</code></span> and <span><code class="highlighter-rouge">sizeof(array)</code></span>? Why?</p>
  </li>
  <li>
    <p>What data structure manages the lifetime of automatic variables?</p>
  </li>
</ol>
<h3 id="chapter-4" class="title-text">Chapter 4</h3>
<p>Heap and stack memory, and working with structs</p>
<ol>
  <li>
    <p>If I want to use data after the lifetime of the function it was created in ends, where should I put it? How do I put it there?</p>
  </li>
  <li>
    <p>What are the differences between heap and stack memory?</p>
  </li>
  <li>
    <p>Are there other kinds of memory in a process?</p>
  </li>
  <li>
    <p>Fill in the blank: “In a good C program, for every malloc, there is a ___”.</p>
  </li>
  <li>
    <p>What is one reason <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/3/malloc" class="fancy-link">malloc</a></code></span> can fail?</p>
  </li>
  <li>
    <p>What are some differences between <span><code class="highlighter-rouge">time()</code></span> and <span><code class="highlighter-rouge">ctime()</code></span>?</p>
  </li>
  <li>
    <p>What is wrong with this code snippet?</p>

    <div class="language-c highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="n">free</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
<span class="n">free</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>What is wrong with this code snippet?</p>

    <div class="language-c highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="n">free</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">ptr</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>How can one avoid the previous two mistakes?</p>
  </li>
  <li>
    <p>Create a <span><code class="highlighter-rouge">struct</code></span> that represents a <span><code class="highlighter-rouge">Person</code></span>. Then make a <span><code class="highlighter-rouge">typedef</code></span>, so that <span><code class="highlighter-rouge">struct Person</code></span> can be replaced with a single word. A person should contain the following information: their name (a string), their age (an integer), and a list of their friends (stored as a pointer to an array of pointers to <span><code class="highlighter-rouge">Person</code></span>s).</p>
  </li>
  <li>
    <p>Now, make two persons on the heap, “Agent Smith” and “Sonny Moore”, who are 128 and 256 years old respectively and are friends with each other. Create functions to create and destroy a Person (Person’s and their names should live on the heap).</p>
  </li>
  <li>
    <p><span><code class="highlighter-rouge">create()</code></span> should take a name and age. The name should be copied onto the heap. Use malloc to reserve sufficient memory for everyone having up to ten friends. Be sure initialize all fields (why?).</p>
  </li>
  <li>
    <p><span><code class="highlighter-rouge">destroy()</code></span> should free up not only the memory of the person struct, but also free all of its attributes that are stored on the heap. Destroying one person should not destroy any others.</p>
  </li>
</ol>
<h3 id="chapter-5" class="title-text">Chapter 5</h3>
<p>Text input and output and parsing using <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/3/getchar" class="fancy-link">getchar</a></code></span>, <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/3/gets" class="fancy-link">gets</a></code></span>, and <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/3/getline" class="fancy-link">getline</a></code></span>.</p>
<ol>
  <li>
    <p>What functions can be used for getting characters from <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/3/stdin" class="fancy-link">stdin</a></code></span> and writing them to <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/3/stdout" class="fancy-link">stdout</a></code></span>?</p>
  </li>
  <li>
    <p>Name one issue with <span><code class="highlighter-rouge">gets()</code></span>.</p>
  </li>
  <li>
    <p>Write code that parses the string “Hello 5 World” and initializes 3 variables to “Hello”, 5, and “World”.</p>
  </li>
  <li>
    <p>What does one need to define before including <span><code class="highlighter-rouge">getline()</code></span>?</p>
  </li>
  <li>
    <p>Write a C program to print out the content of a file line-by-line using <span><code class="highlighter-rouge">getline()</code></span>.</p>
  </li>
</ol>
<h3 id="c-development" class="title-text">C Development</h3>
<p>These are general tips for compiling and developing using a compiler and git. Some web searches will be useful here</p>
<ol>
  <li>
    <p>What compiler flag is used to generate a debug build?</p>
  </li>
  <li>
    <p>You fix a problem in the Makefile and type <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/3/make" class="fancy-link">make</a></code></span> again. Explain why this may be insufficient to generate a new build.</p>
  </li>
  <li>
    <p>Are tabs or spaces used to indent the commands after the rule in a Makefile?</p>
  </li>
  <li>
    <p>What does <span><code class="highlighter-rouge">git commit</code></span> do? What’s a <span><code class="highlighter-rouge"><a href="https://linux.die.net/man/3/sha" class="fancy-link">sha</a></code></span> in the context of git?</p>
  </li>
  <li>
    <p>What does <span><code class="highlighter-rouge">git log</code></span> show you?</p>
  </li>
  <li>
    <p>What does <span><code class="highlighter-rouge">git status</code></span> tell you and how would the contents of <span><code class="highlighter-rouge">.gitignore</code></span> change its output?</p>
  </li>
  <li>
    <p>What does <span><code class="highlighter-rouge">git push</code></span> do? Why is it not just sufficient to commit with <span><code class="highlighter-rouge">git commit -m ’fixed all bugs’ </code></span>?</p>
  </li>
  <li>
    <p>What does a non-fast-forward error <span><code class="highlighter-rouge">git push</code></span> reject mean? What is the most common way of dealing with this?</p>
  </li>
</ol>
<h3 id="optional-just-for-fun" class="title-text">Optional: Just for fun</h3>
<ul>
  <li>
    <p>Convert your a song lyrics into System Programming and C code covered in this wiki book and share on Piazza.</p>
  </li>
  <li>
    <p>Find, in your opinion, the best and worst C code on the web and post the link to Piazza.</p>
  </li>
  <li>
    <p>Write a short C program with a deliberate subtle C bug and post it on Piazza to see if others can spot your bug.</p>
  </li>
  <li>
    <p>Do you have any cool/disastrous system programming bugs you’ve heard about? Feel free to share with your peers and the course staff on piazza.</p>
  </li>
</ul>
</div></div></div>
</div></div>
<div class="pad"><div class="card">
<div class="title"><h2 id="uiuc-specific-guidlines" class="title-text">UIUC Specific Guidlines<a class="anchor title-text" href="#uiuc-specific-guidlines">#</a>
</h2></div>






<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<h3 id="piazza" class="title-text">Piazza</h3>
<p>TAs and student assistants get a ton of questions. Some are well-researched, and some…are not. This is a handy guide that’ll help you move away from the latter and towards the former. Oh, and did I mention that this is an easy way to score points with your internship managers? Ask yourself…</p>
<ol>
  <li>
    <p>Am I running on EWS?</p>
  </li>
  <li>
    <p><strong>Did I check the man pages?</strong></p>
  </li>
  <li>
    <p>Have I searched for similar questions/followups on Piazza?</p>
  </li>
  <li>
    <p>Have I read the MP/DS specification completely?</p>
  </li>
  <li>
    <p>Have I watched all of the videos?</p>
  </li>
  <li>
    <p>Did I Google the error message and a few permutations thereof if necessary?</p>
  </li>
  <li>
    <p>Did I try commenting out, printlining, and/or stepping through parts of the code bit by bit to find out precisely where the error occurs?</p>
  </li>
  <li>
    <p><strong>Did I commit my code to git in case the TAs need more context?</strong></p>
  </li>
  <li>
    <p>Did I include the console/GDB/Valgrind output **AND** code surrounding the bug in my Piazza post?</p>
  </li>
  <li>
    <p>Have I fixed other segmentation faults not related to the issue I’m having?</p>
  </li>
  <li>
    <p>Am I following good programming practice? (i.e. encapsulation, functions to limit repetition, etc)</p>
  </li>
</ol>
</div></div></div>
</div></div>
</div>
          
          <div class="wrapper">
</div>
      </div>
      <div class="col-md-2 col-sm-1 col-xs-0"></div>
    </div>
  </div>
  <script>
    var github_repo = "illinois-cs241/illinois-cs241.github.io";
    var github_path = "_coursebook/Background.md";
  </script>
  <!-- Mathjax takes a while to load so do a lazy load to so we can get accessibility -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" crossorigin="anonymous"></script>

<!-- Bring in JQuery and Bootstrap -->
<script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script>

<!-- Again bust cache on the main.js file -->
<script src="/js/main.js?v='2019-01-16 13:38:19 -0600'"></script>

<footer class="">

<div class="container-fluid">
<div class="shadow"></div>

</div>

</footer>

</body>
</html>
